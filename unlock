#!/bin/bash
echo "🔓 サーボロック解除..."

# マニュアルモードに切り替え
echo "📍 マニュアルモードに切り替え中..."
ros2 service call /cobot/manual std_srvs/srv/Empty > /dev/null 2>&1

# 少し待機
sleep 1

# サーボロック解除を直接実行
echo "🔧 サーボロック解除実行中..."
python3 -c "
import sys
import time
sys.path.append('/home/ros2/ros2_ws/src/cobot')
try:
    from pymycobot import MyCobot280
    robot = MyCobot280('/dev/ttyAMA0', 1000000)
    time.sleep(1)  # 接続待機
    
    # ティーチングモード状態確認
    is_free = robot.is_free_mode()
    print(f'🎯 ティーチングモード: {is_free}')
    
    if is_free:
        print('🔄 ティーチングモード解除中...')
        robot.set_free_mode(0)  # ティーチングモード解除
        time.sleep(1)  # モード切り替え待機
    
    robot.release_all_servos()
    print('✅ サーボロック解除完了')
except Exception as e:
    print(f'❌ サーボロック解除失敗: {e}')
"

echo "✅ 完了"
