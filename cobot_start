#!/bin/bash
# cobot_nodeå®‰å…¨èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

echo "ğŸš€ cobot_nodeèµ·å‹•ä¸­..."

# æ—¢å­˜ã®cobot_nodeãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèªãƒ»åœæ­¢
if pgrep -f "cobot_node" > /dev/null; then
    echo "âš ï¸ æ—¢å­˜ã®cobot_nodeã‚’åœæ­¢ä¸­..."
    pkill -f cobot_node
    sleep 3
    
    # å¼·åˆ¶åœæ­¢ãŒå¿…è¦ãªå ´åˆ
    if pgrep -f "cobot_node" > /dev/null; then
        echo "ğŸ”¥ å¼·åˆ¶åœæ­¢å®Ÿè¡Œä¸­..."
        pkill -9 -f cobot_node
        sleep 2
    fi
fi

# ãƒãƒ¼ãƒˆã®ä½¿ç”¨çŠ¶æ³ç¢ºèª
if lsof /dev/ttyAMA0 2>/dev/null; then
    echo "âš ï¸ /dev/ttyAMA0ãŒä½¿ç”¨ä¸­ã§ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
    lsof /dev/ttyAMA0
    echo "5ç§’å¾Œã«èµ·å‹•ã‚’è©¦è¡Œã—ã¾ã™..."
    sleep 5
fi

# ROS2ç’°å¢ƒè¨­å®š
source /home/ros2/ros2_ws/install/setup.bash

# cobot_nodeèµ·å‹•
echo "âœ… cobot_nodeèµ·å‹•..."
ros2 run cobot cobot_node
