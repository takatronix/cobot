#!/bin/bash
# ä½ç½®ãƒªã‚¹ãƒˆè¡¨ç¤ºï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆå½¢å¼ï¼‰

echo "ğŸ“‹ ä¿å­˜æ¸ˆã¿ä½ç½®ä¸€è¦§:"

# positionsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å…¨JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Š
for json_file in /home/ros2/cobot/positions/*.json; do
    if [ -f "$json_file" ]; then
        name=$(basename "$json_file" .json)
        
        # JSONã‹ã‚‰anglesã¨gripper_valueã‚’æŠ½å‡º
        if command -v jq > /dev/null 2>&1; then
            # jqãŒã‚ã‚‹å ´åˆ
            angles=$(jq -r '.angles | @csv' "$json_file" 2>/dev/null | tr -d '"')
            gripper=$(jq -r '.gripper_value' "$json_file" 2>/dev/null)
        else
            # jqãŒãªã„å ´åˆã¯grepã§æŠ½å‡º
            angles=$(grep -A 10 '"angles"' "$json_file" | grep -E '^\s*-?[0-9]' | sed 's/[^-0-9.]//g' | tr '\n' ',' | sed 's/,$//')
            gripper=$(grep '"gripper_value"' "$json_file" | sed 's/.*: *\([0-9]*\).*/\1/')
        fi
        
        # ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆå½¢å¼ã§è¡¨ç¤º: [j1,j2,j3,j4,j5,j6] g:xxx
        printf "%-8s [%s] g:%s\n" "$name:" "$angles" "$gripper"
    fi
done